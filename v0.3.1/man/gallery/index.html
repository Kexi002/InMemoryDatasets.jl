<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Gallery · In Memory Datasets</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">In Memory Datasets</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../basics/">First Steps</a></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../tutorial/">Tutorial</a></li><li><a class="tocitem" href="../formats/">Formats</a></li><li><a class="tocitem" href="../map/">Call functions on each observation</a></li><li><a class="tocitem" href="../byrow/">Row-wise operations</a></li><li><a class="tocitem" href="../modify/">Transform columns</a></li><li><a class="tocitem" href="../filter/">Filter observations</a></li><li><a class="tocitem" href="../sorting/">Sort</a></li><li><a class="tocitem" href="../grouping/">Group observations</a></li><li><a class="tocitem" href="../aggregation/">Aggregation</a></li><li><a class="tocitem" href="../transpose/">Transpose data</a></li><li><a class="tocitem" href="../joins/">Joins</a></li></ul></li><li class="is-active"><a class="tocitem" href>Gallery</a><ul class="internal"><li><a class="tocitem" href="#map!-and-map"><span><code>map!</code> and <code>map</code></span></a></li><li><a class="tocitem" href="#Row-operations,-byrow"><span>Row operations, <code>byrow</code></span></a></li><li><a class="tocitem" href="#Filtering"><span>Filtering</span></a></li><li><a class="tocitem" href="#Grouping"><span>Grouping</span></a></li><li><a class="tocitem" href="#Joins"><span>Joins</span></a></li><li><a class="tocitem" href="#Reshape"><span>Reshape</span></a></li><li><a class="tocitem" href="#for-loops"><span><code>for loops</code></span></a></li></ul></li><li><a class="tocitem" href="../performance/">Performance tips</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Gallery</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Gallery</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sl-solution/InMemoryDatasets.jl/blob/master/docs/src/man/gallery.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Gallery"><a class="docs-heading-anchor" href="#Gallery">Gallery</a><a id="Gallery-1"></a><a class="docs-heading-anchor-permalink" href="#Gallery" title="Permalink"></a></h1><p>This gallery contains some random questions about data manipulation that we found on internet. The original questions are posted in different forums and are related to different packages. Whenever, we can remember the original source of a question we provide a link to it, otherwise, we just re-asked the question as we remember it. There is no particular theme about the questions, we just found them interesting since, a) they are not trivial, b) they can be done relatively easy in InMemoryDatasets, c) our solution is more efficient than what we found in the original source.</p><h2 id="map!-and-map"><a class="docs-heading-anchor" href="#map!-and-map"><code>map!</code> and <code>map</code></a><a id="map!-and-map-1"></a><a class="docs-heading-anchor-permalink" href="#map!-and-map" title="Permalink"></a></h2><ul><li>How to randomly change about 10% of data values to missing?</li></ul><pre><code class="language-julia hljs">julia&gt; ds = Dataset(rand(10, 3), :auto)
10×3 Dataset
 Row │ x1         x2         x3        
     │ identity   identity   identity  
     │ Float64?   Float64?   Float64?  
─────┼─────────────────────────────────
   1 │ 0.829492   0.266336   0.712512
   2 │ 0.206569   0.252967   0.133839
   3 │ 0.0773648  0.420897   0.363549
   4 │ 0.404912   0.495679   0.400661
   5 │ 0.412908   0.740628   0.785319
   6 │ 0.624809   0.971097   0.725747
   7 │ 0.19843    0.378382   0.0453478
   8 │ 0.851221   0.563592   0.450065
   9 │ 0.351243   0.0555308  0.142801
  10 │ 0.208414   0.739952   0.926834

julia&gt; map!(ds, x-&gt;rand()&lt;.1 ? missing : x, :)
10×3 Dataset
 Row │ x1               x2               x3        
     │ identity         identity         identity  
     │ Float64?         Float64?         Float64?  
─────┼─────────────────────────────────────────────
   1 │       0.829492         0.266336   0.712512
   2 │       0.206569         0.252967   0.133839
   3 │       0.0773648        0.420897   0.363549
   4 │       0.404912         0.495679   0.400661
   5 │ missing                0.740628   0.785319
   6 │       0.624809   missing          0.725747
   7 │       0.19843          0.378382   0.0453478
   8 │ missing                0.563592   0.450065
   9 │       0.351243         0.0555308  0.142801
  10 │       0.208414         0.739952   0.926834</code></pre><h2 id="Row-operations,-byrow"><a class="docs-heading-anchor" href="#Row-operations,-byrow">Row operations, <code>byrow</code></a><a id="Row-operations,-byrow-1"></a><a class="docs-heading-anchor-permalink" href="#Row-operations,-byrow" title="Permalink"></a></h2><ul><li>In each row, how to replace missing values in a column by the first non-missing in previous columns. (Assuming for the first column the direction of search is reversed and all columns has the same type)</li></ul><pre><code class="language-julia hljs">julia&gt; ds = Dataset(rand([1,2,3, missing], 10, 6), :auto)
10×6 Dataset
 Row │ x1        x2        x3        x4        x5        x6       
     │ identity  identity  identity  identity  identity  identity
     │ Int64?    Int64?    Int64?    Int64?    Int64?    Int64?   
─────┼────────────────────────────────────────────────────────────
   1 │        1         1   missing         2   missing   missing
   2 │        2         1         3         3         2         3
   3 │        2         1   missing         3         3   missing
   4 │        1   missing   missing         1         1         1
   5 │        2         2   missing         1         3         1
   6 │  missing   missing         2         1   missing         1
   7 │  missing         2         3   missing         1         2
   8 │        3         3   missing         1         1         1
   9 │        3         1         1         3         1   missing
  10 │  missing         1         3         1         1         3

julia&gt; f_n_m = byrow(ds, coalesce, :); # we will use this if the first column is missing

julia&gt; op(x, y) = y .= ifelse.(ismissing.(y), x, y)
op (generic function with 1 method)

julia&gt; byrow(ds, mapreduce, :, op = op, init = f_n_m);

julia&gt; ds
10×6 Dataset
 Row │ x1        x2        x3        x4        x5        x6       
     │ identity  identity  identity  identity  identity  identity
     │ Int64?    Int64?    Int64?    Int64?    Int64?    Int64?   
─────┼────────────────────────────────────────────────────────────
   1 │        1         1         1         2         2         2
   2 │        2         1         3         3         2         3
   3 │        2         1         1         3         3         3
   4 │        1         1         1         1         1         1
   5 │        2         2         2         1         3         1
   6 │        2         2         2         1         1         1
   7 │        2         2         3         3         1         2
   8 │        3         3         3         1         1         1
   9 │        3         1         1         3         1         1
  10 │        1         1         3         1         1         3

julia&gt; # write our own version of pandas&#39; ffill-bfill
julia&gt; function fbfill!(ds, cols)
         f_n_m = byrow(ds, coalesce, cols)
         op(x, y) = y .= ifelse.(ismissing.(y), x, y)
         byrow(ds, mapreduce, cols, op = op, init = f_n_m)
         ds
      end</code></pre><h2 id="Filtering"><a class="docs-heading-anchor" href="#Filtering">Filtering</a><a id="Filtering-1"></a><a class="docs-heading-anchor-permalink" href="#Filtering" title="Permalink"></a></h2><ul><li><a href="https://discourse.julialang.org/t/dataframe-filtering-based-on-conditions-comparing-one-column-to-other-columns/70802">Filtering based on conditions comparing one column to other columns</a> : In the following example we like to filter rows where columns <code>:x1</code> and <code>:x2</code> are greater than <code>:x5</code>.</li></ul><pre><code class="language-julia hljs">julia&gt; ds = Dataset(rand(10, 5), :auto)
10×5 Dataset
 Row │ x1         x2        x3          x4         x5         
     │ identity   identity  identity    identity   identity   
     │ Float64?   Float64?  Float64?    Float64?   Float64?   
─────┼────────────────────────────────────────────────────────
   1 │ 0.399934   0.855727  0.0807368   0.862328   0.941958
   2 │ 0.71988    0.392431  0.00232494  0.79383    0.0166697
   3 │ 0.9772     0.605505  0.0674462   0.188414   0.885489
   4 │ 0.469928   0.926895  0.0541956   0.329512   0.973956
   5 │ 0.888978   0.529202  0.4728      0.234747   0.00479635
   6 │ 0.955468   0.756809  0.285243    0.78437    0.674951
   7 │ 0.0518425  0.835133  0.24403     0.0364176  0.716292
   8 │ 0.942624   0.345449  0.349736    0.346877   0.449795
   9 │ 0.209472   0.385161  0.118644    0.714821   0.955488
  10 │ 0.162146   0.602297  0.515762    0.145972   0.341771

julia&gt; val_x5 = ds[:, :x5];

julia&gt; op(x, y; colcomp = val_x5) = x .&amp;= y .&gt; colcomp
op (generic function with 1 method)

julia&gt; byrow(ds, mapreduce, 1:2, op = op, init = ones(Bool, nrow(ds)))
10-element Vector{Bool}:
 0
 1
 0
 0
 1
 1
 0
 0
 0
 0</code></pre><h2 id="Grouping"><a class="docs-heading-anchor" href="#Grouping">Grouping</a><a id="Grouping-1"></a><a class="docs-heading-anchor-permalink" href="#Grouping" title="Permalink"></a></h2><ul><li><a href="https://stackoverflow.com/questions/69762612/how-to-remove-rows-based-on-next-value-in-a-sequence-pandas">How to remove rows based on next value in a sequence?</a> : I have a data set where it is grouped based on <code>:id</code> and in ascending order for <code>:date</code>. I want to remove a row if the row after it has the same <code>:outcome</code>.</li></ul><pre><code class="language-julia hljs">julia&gt; ds = Dataset(id = [1,1,1,1,1,2,2,2,3,3,3],
                    date = Date.([&quot;2019-03-05&quot;, &quot;2019-03-12&quot;, &quot;2019-04-10&quot;,
                            &quot;2019-04-29&quot;, &quot;2019-05-10&quot;, &quot;2019-03-20&quot;,
                            &quot;2019-04-22&quot;, &quot;2019-05-04&quot;, &quot;2019-11-01&quot;,
                            &quot;2019-11-10&quot;, &quot;2019-12-12&quot;]),
                    outcome = [false, false, false, true, false, false,
                               true, false, true, true, true])
11×3 Dataset
 Row │ id        date        outcome  
     │ identity  identity    identity
     │ Int64?    Date?       Bool?    
─────┼────────────────────────────────
   1 │        1  2019-03-05     false
   2 │        1  2019-03-12     false
   3 │        1  2019-04-10     false
   4 │        1  2019-04-29      true
   5 │        1  2019-05-10     false
   6 │        2  2019-03-20     false
   7 │        2  2019-04-22      true
   8 │        2  2019-05-04     false
   9 │        3  2019-11-01      true
  10 │        3  2019-11-10      true
  11 │        3  2019-12-12      true

julia&gt; combine(gatherby(ds, [1, 3], isgathered = true),
                        (:) =&gt; last,
                        dropgroupcols = true)
7×3 Dataset
 Row │ id_last   date_last   outcome_last
     │ identity  identity    identity     
     │ Int64?    Date?       Bool?        
─────┼────────────────────────────────────
   1 │        1  2019-04-10         false
   2 │        1  2019-04-29          true
   3 │        1  2019-05-10         false
   4 │        2  2019-03-20         false
   5 │        2  2019-04-22          true
   6 │        2  2019-05-04         false
   7 │        3  2019-12-12          true</code></pre><h2 id="Joins"><a class="docs-heading-anchor" href="#Joins">Joins</a><a id="Joins-1"></a><a class="docs-heading-anchor-permalink" href="#Joins" title="Permalink"></a></h2><ul><li><a href="https://stackoverflow.com/questions/69994244/counting-the-number-of-instances-between-dates">Counting the number of instances between dates</a> : What I want to do is simply count the number of employees that each store has on any given date in the <code>store</code> data set</li></ul><pre><code class="language-julia hljs">julia&gt; store = Dataset([Date.([&quot;2019-10-01&quot;, &quot;2019-10-02&quot;, &quot;2019-10-03&quot;, &quot;2019-10-04&quot;,
                         &quot;2019-10-05&quot;, &quot;2019-10-01&quot;, &quot;2019-10-02&quot;, &quot;2019-10-03&quot;,
                         &quot;2019-10-04&quot;, &quot;2019-10-05&quot;]),
                         [&quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;B&quot;, &quot;B&quot;, &quot;B&quot;, &quot;B&quot;, &quot;B&quot;]],
                         [&quot;date&quot;, &quot;store&quot;])
julia&gt; roster = Dataset([[&quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;B&quot;, &quot;B&quot;, &quot;B&quot;, &quot;B&quot;],
                         [1, 2, 3, 4, 5, 6, 7, 8],
                         [Date(&quot;2019-09-30&quot;), Date(&quot;2019-10-02&quot;), Date(&quot;2019-10-03&quot;), Date(&quot;2019-10-04&quot;),
                         Date(&quot;2019-09-30&quot;), Date(&quot;2019-10-02&quot;), Date(&quot;2019-10-03&quot;), Date(&quot;2019-10-04&quot;)],
                         [Date(&quot;2019-10-04&quot;), Date(&quot;2019-10-04&quot;), Date(&quot;2019-10-05&quot;), Date(&quot;2019-10-06&quot;),
                         Date(&quot;2019-10-04&quot;), Date(&quot;2019-10-04&quot;), Date(&quot;2019-10-05&quot;), Date(&quot;2019-10-06&quot;)]],
                         [&quot;store&quot;, &quot;employee_ID&quot;, &quot;start_date&quot;, &quot;end_date&quot;])
julia&gt; using Chain
julia&gt; @chain store begin
          innerjoin(roster, on = [:store =&gt; :store, :date =&gt; (:start_date, :end_date)])
          groupby([:store, :date])
          combine(:employee_ID =&gt; length)
       end
10×3 Dataset
 Row │ store     date        employee_ID_length
     │ identity  identity    identity           
     │ String?   Date?       Int64?             
─────┼──────────────────────────────────────────
   1 │ A         2019-10-01                   1
   2 │ A         2019-10-02                   2
   3 │ A         2019-10-03                   3
   4 │ A         2019-10-04                   4
   5 │ A         2019-10-05                   2
   6 │ B         2019-10-01                   1
   7 │ B         2019-10-02                   2
   8 │ B         2019-10-03                   3
   9 │ B         2019-10-04                   4
  10 │ B         2019-10-05                   2</code></pre><h2 id="Reshape"><a class="docs-heading-anchor" href="#Reshape">Reshape</a><a id="Reshape-1"></a><a class="docs-heading-anchor-permalink" href="#Reshape" title="Permalink"></a></h2><ul><li><a href="https://stackoverflow.com/questions/70228385/how-to-transpose-or-pivote-a-table-selecting-specific-columns">How to transpose or pivote a table? Selecting specific columns</a> : I need to pivot or transpose my data, keeping the Country Code, the years, and the indicators names as columns</li></ul><pre><code class="language-julia hljs">julia&gt; ds = Dataset(&quot;Country_Code&quot;=&gt;[&quot;FR&quot;,&quot;FR&quot;,&quot;FR&quot;,&quot;USA&quot;,&quot;USA&quot;,&quot;USA&quot;,&quot;BR&quot;,&quot;BR&quot;,&quot;BR&quot;],
                    &quot;Indicator_Name&quot;=&gt;[&quot;GPD&quot;,&quot;Pop&quot;,&quot;birth&quot;,&quot;GPD&quot;,&quot;Pop&quot;,&quot;birth&quot;,&quot;GPD&quot;,&quot;Pop&quot;,&quot;birth&quot;],
                    &quot;2005&quot;=&gt;[14,34,56, 25, 67, 68, 55, 8,99],
                    &quot;2006&quot;=&gt;[23, 34, 34, 43,34,34, 65, 34,45])
9×4 Dataset
 Row │ Country_Code  Indicator_Name  2005      2006     
     │ identity      identity        identity  identity
     │ String?       String?         Int64?    Int64?   
─────┼──────────────────────────────────────────────────
   1 │ FR            GPD                   14        23
   2 │ FR            Pop                   34        34
   3 │ FR            birth                 56        34
   4 │ USA           GPD                   25        43
   5 │ USA           Pop                   67        34
   6 │ USA           birth                 68        34
   7 │ BR            GPD                   55        65
   8 │ BR            Pop                    8        34
   9 │ BR            birth                 99        45

julia&gt; transpose(gatherby(ds, 1), 3:4, id = r&quot;Name&quot;)
6×5 Dataset
 Row │ Country_Code  _variables_  GPD       Pop       birth    
     │ identity      identity     identity  identity  identity
     │ String?       String?      Int64?    Int64?    Int64?   
─────┼─────────────────────────────────────────────────────────
   1 │ FR            2005               14        34        56
   2 │ FR            2006               23        34        34
   3 │ USA           2005               25        67        68
   4 │ USA           2006               43        34        34
   5 │ BR            2005               55         8        99
   6 │ BR            2006               65        34        45</code></pre><h2 id="for-loops"><a class="docs-heading-anchor" href="#for-loops"><code>for loops</code></a><a id="for-loops-1"></a><a class="docs-heading-anchor-permalink" href="#for-loops" title="Permalink"></a></h2><ul><li><a href="https://stackoverflow.com/questions/69920121/map-select-rows-to-a-new-column">map select rows to a new column</a> :  I want to use rows with names Becks, Campbell, Crows as a separate column to name the entries below them.</li></ul><pre><code class="language-julia hljs">julia&gt; using Chain
julia&gt; ds = Dataset( [[&quot;Becks&quot;, &quot;307NRR&quot;, &quot;321NRR&quot;, &quot;342NRR&quot;, &quot;Campbell&quot;, &quot;329NRR&quot;, &quot;347NRR&quot;, &quot;Crows&quot;, &quot;C3001R&quot;],
                     [missing, &quot;R&quot;, &quot;R&quot;, &quot;R&quot;, missing, &quot;R&quot;, &quot;R&quot;, missing, &quot;R&quot;],
                     [missing, &quot;CM,SG&quot;, &quot;CM,SG&quot;, &quot;CM,SG&quot;, missing, &quot;None&quot;, &quot;None&quot;, missing, &quot;None&quot;],
                     [missing, 3.0, 3.2, 3.4, missing, 3.2, 3.4, missing, 3.0]], :auto)
9×4 Dataset
 Row │ x1        x2        x3        x4        
     │ identity  identity  identity  identity  
     │ String?   String?   String?   Float64?  
─────┼─────────────────────────────────────────
   1 │ Becks     missing   missing   missing   
   2 │ 307NRR    R         CM,SG           3.0
   3 │ 321NRR    R         CM,SG           3.2
   4 │ 342NRR    R         CM,SG           3.4
   5 │ Campbell  missing   missing   missing   
   6 │ 329NRR    R         None            3.2
   7 │ 347NRR    R         None            3.4
   8 │ Crows     missing   missing   missing   
   9 │ C3001R    R         None            3.0

julia&gt; function replace_with_prev(x,y)
           res = similar(x, length(x))
           for i in 1:length(x)
               if !ismissing(y[i])
                   res[i] = res[i-1]
               else
                   res[i] = x[i]
               end
           end
           res
       end
f1 (generic function with 2 methods)
julia&gt; @chain ds begin
         modify!((1,2)=&gt;replace_with_prev=&gt;:name) # find previous name
         dropmissing!(2) # drop unwanted rows
         select!(:name, :) # rearrange columns
      end
6×5 Dataset
 Row │ name      x1        x2        x3        x4       
     │ identity  identity  identity  identity  identity
     │ String?   String?   String?   String?   Float64?
─────┼──────────────────────────────────────────────────
   1 │ Becks     307NRR    R         CM,SG          3.0
   2 │ Becks     321NRR    R         CM,SG          3.2
   3 │ Becks     342NRR    R         CM,SG          3.4
   4 │ Campbell  329NRR    R         None           3.2
   5 │ Campbell  347NRR    R         None           3.4
   6 │ Crows     C3001R    R         None           3.0</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../joins/">« Joins</a><a class="docs-footer-nextpage" href="../performance/">Performance tips »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Monday 6 December 2021 23:30">Monday 6 December 2021</span>. Using Julia version 1.7.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
